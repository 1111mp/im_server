<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>

  <body>
    <input id="input" type="text" />
    <!-- <button onclick="send()">发送</button> -->
    <br />
    <button>离线消息</button>
  </body>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.0/socket.io.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/uuid/8.1.0/uuidv4.min.js"></script>
  <script>
    // const url = "ws://192.168.80.208:3000"
    const url =
      "ws://127.0.0.1:3000/im?userid=10005&token=40a04112-93c6-4581-bd6e-e08bfa56a045";
    const token = "376a7114-d226-461a-8527-3566cc072649",
      userid = 10001;

    const socket = new WebSocket(url);

    socket.onmessage = (evt) => {
      console.log(evt);
      // socket.send("ping");
      // socket.send(
      //   JSON.stringify({
      //     msgId: uuidv4(),
      //     receiver: 10002,
      //     content: "this is a message from A",
      //   })
      // );
    };

    socket.onopen = (socket, evt) => {
      console.log(socket);
      console.log(evt);
    };

    socket.onclose = (socket, evt) => {
      console.log(socket);
      console.log(evt);
    };

    // let socket = io(url, {
    //   transports: ["polling", "websocket"],
    //   extraHeaders: {
    //     token: "376a7114-d226-461a-8527-3566cc072649",
    //     userid: 10001,
    //   },
    //   transportOptions: {
    //     polling: {
    //       extraHeaders: {
    //         token: "376a7114-d226-461a-8527-3566cc072649",
    //         userid: 10001,
    //       },
    //     },
    //   },
    //   reconnectionAttempts: 20,
    // });

    // socket.on("connect", (socket) => {
    //   console.log("connect successed");
    // });

    // socket.on("connect_error", (err) => {
    //   console.log("connect_error");
    //   console.log(err);
    //   console.log(err.message);
    //   if (err.message === "authentication failed") {
    //     socket.disconnect();
    //   }
    // });

    // socket.on("disconnect", (res) => {
    //   console.log(res);
    // });

    // socket.on("connect_failed", (res) => {
    //   console.log(res);
    // });

    // socket.on("error", (err) => {
    //   console.log(err);
    // });

    // function invoke(type, args) {
    //   return new Promise((resolve, reject) => {
    //     socket.emit(
    //       "invoke",
    //       JSON.stringify({
    //         type,
    //         args,
    //       }),
    //       (res) => {
    //         resolve(res);
    //       }
    //     );
    //   });
    // }

    // function send() {
    //   let input = document.getElementById("input");
    //   let msg = {
    //     msgId: uuidv4(),
    //     type: 0,
    //     sessionType: 0,
    //     content: input.value,
    //     sender: {
    //       userId: 10000,
    //     },
    //     receiver: 10002,
    //   };
    //   console.log(msg);
    //   invoke("send-msg", msg).then((res) => {
    //     console.log(11111111);
    //     console.log(res);
    //   });
    // }
  </script>
</html>
